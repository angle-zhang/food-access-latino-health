---
title: "2_prelim_results"
author: "Angela Zhang"
date: "2025-04-02"
output: html_document
---

```{r setup, include=FALSE}
source("0_Libraries.R")
# run summarize measures
# source('2_summarize_measures')
```
# Planning document
- [Methods description is here](https://docs.google.com/document/d/1rAyl0qsaWPcxM4E1X8-hP70vpzbPF7CYUYRq4pbERDM/edit?tab=t.0)

# Pull in relevant data sources
```{r}

usdafa <- read.xlsx(paste0(base_path, "./USDA_foodatlas/FoodAccessResearchAtlasData2019.xlsx"))
ct_driving <- read.csv(paste0(processed_path, "LAC_cleaned/ct_driving_times.csv"))


```


## Sanity checks
✔️ We expect there to be 1424424 households in LA City
- We also want to see why some CTs are missing observations in the household aggregate measures
````{r}
nrow(la_city_hh) # 1424424
head(dt_household) 
length(unique(dt_household$id)) # 1424424
```


## Visualize CT level data for all measures

```{r cars}
# visualize ct_level data
head(read.csv(paste0(processed_path, "/LAC_cleaned/ct_driving_times.csv"))) 

la_ct <- get_census_tracts(proj_crs, state="CA", year=2020, county="Los Angeles") %>%
  mutate(GEOID = as.numeric(GEOID)) 

# map census tract data 
# merge census tracts
# filter any missing data
ct_drive_data <- la_ct %>%
  merge(read.csv(paste0(processed_path, "/LAC_cleaned/ct_driving_times.csv")) , by = "GEOID")

# plot census tract data
tmap_mode("plot")
map <- tm_shape(ct_drive_data) +
  tm_polygons(col = "driving_FF_15_parcel_mean", style = "quantile", palette = "Blues") #+
  # tm_shape(la_county) +
  # tm_borders() +
  # tm_shape(ocean) +
  # tm_polygons(col="lightblue")+
  # tm_shape(la_parks) +
  # tm_polygons(col="mediumseagreen") +
  # tm_layout(inner.margins = c(0.1, .1, 0.2, 0.1)) +
  # tm_scale_bar())


print(map)

```

```{r}

tm_shape(ct_drive_data) +
  tm_polygons(col = "driving_count_5_ct_cent", style = "quantile", palette = "Blues")  +
  tm_shape(la_county) +
  tm_borders() +
  tm_shape(ocean) +
  tm_polygons(col="lightblue")+
  tm_shape(la_parks) +
  tm_polygons(col="mediumseagreen") +
  tm_layout(inner.margins = c(0.1, .1, 0.2, 0.1)) +
  tm_scale_bar()


tm_shape(ct_drive_data) +
  tm_polygons(col = "driving_count_5_ct_wtcent", style = "quantile", palette = "Blues") +
  tm_shape(la_county) +
  tm_borders() +
  tm_shape(ocean) +
  tm_polygons(col="lightblue")+
  tm_shape(la_parks) +
  tm_polygons(col="mediumseagreen") +
  tm_layout(inner.margins = c(0.1, .1, 0.2, 0.1)) +
  tm_scale_bar()


```

```{r}

hist(ct_drive_data$driving_count_5_parcel_mean, breaks = 50, main = "Histogram", xlab = "Markets with 5 minutes driving time", col = "lightblue")

hist(ct_drive_data$driving_count_5_ct_cent, breaks = 50, main = "Histogram", xlab = "Markets with 5 minutes driving time", col = "lightblue")

hist(ct_drive_data$driving_count_5_ct_wtcent, breaks = 50, main = "Histogram", xlab = "Markets with 5 minutes driving time", col = "lightblue")

# run histogram for each time using for loop
for(i in c(5, 10, 15, 20, 25)) {
  # histogram
    par(mfrow=c(,3))

  # make text smaller
  par(cex.main=0.5)
  hist(ct_drive_data[[paste0("driving_count_", i, "_parcel_mean")]], breaks = 50, main = paste0("Histogram of Markets with ", i, " minutes driving time"), col = "lightblue")
  
  hist(ct_drive_data[[paste0("driving_count_", i, "_ct_cent")]], breaks = 50, main = paste0("Histogram of Markets with ", i, " minutes driving time"), col = "lightblue")
  
  hist(ct_drive_data[[paste0("driving_count_", i, "_ct_wtcent")]], breaks = 50, main = paste0("Histogram of Markets with ", i, " minutes driving time"), col = "lightblue")
# display all in one panel

  }

```

```{r}



```


## Calculate t-tests to evaluate differences in distributions

```{r}
  # populate table
  t_test_results <- rbind(t_test_results, data.frame(
    time = i,
    t_test_parcel_cent = t.test(
      ct_drive_data[[paste0("driving_count_", i, "_parcel_mean")]], 
      ct_drive_data[[paste0("driving_count_", i, "_ct_cent")]], 
      paired = TRUE)$p.value,
    t_test_parcel_wtcent = t.test(
      ct_drive_data[[paste0("driving_count_", i, "_parcel_mean")]], 
      ct_drive_data[[paste0("driving_count_", i, "_ct_wtcent")]], 
      paired = TRUE)$p.value,
    t_test_cent_wtcent = t.test(
      ct_drive_data[[paste0("driving_count_", i, "_ct_cent")]], 
      ct_drive_data[[paste0("driving_count_", i, "_ct_wtcent")]], 
      paired = TRUE)$p.value,
    wilcoxon_parcel_cent = wilcox.test(
      ct_drive_data[[paste0("driving_count_", i, "_parcel_mean")]], 
      ct_drive_data[[paste0("driving_count_", i, "_ct_cent")]], 
      paired = TRUE)$p.value,
    wilcoxon_parcel_wtcent = wilcox.test(
      ct_drive_data[[paste0("driving_count_", i, "_parcel_mean")]], 
      ct_drive_data[[paste0("driving_count_", i, "_ct_wtcent")]], 
      paired = TRUE)$p.value,
    wilcoxon_cent_wtcent = wilcox.test(
      ct_drive_data[[paste0("driving_count_", i, "_ct_cent")]], 
      ct_drive_data[[paste0("driving_count_", i, "_ct_wtcent")]], 
      paired = TRUE)$p.value
  ))
  }
```

```{r}
# walk data
tmp_walk <- read.csv(paste0(processed_path, "/LAC_cleaned/ct_walking_times.csv")) 
ct_walk_data <- la_ct %>%
  merge(tmp_walk, by = "GEOID") %>%
  filter(!is.na(walking_count_15_parcel_mean)) 

# plot census tract data
tm_shape(ct_walk_data) +
  tm_polygons(col = "walking_count_5_parcel_mean", style = "quantile", palette = "Blues") +
  tm_layout(title = "Census Tract Walking Times to Grocery Stores")

tm_shape(ct_walk_data) +
  tm_polygons(col = "walking_count_15_parcel_mean", style = "quantile", palette = "Blues") +
  tm_layout(title = "Census Tract Walking Times to Grocery Stores")

tm_shape(ct_walk_data) +
  tm_polygons(col = "walking_count_30_parcel_mean", style = "quantile", palette = "Blues") +
  tm_layout(title = "Census Tract Walking Times to Grocery Stores")

## Including Plots
```
You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

## Map El Sendero data 
```{r}
elsend <- read.csv("../../0_shared-data/latino-health-elsendero/raw/ElSenderoPathwaysToH_DATA_LABELS_2025-04-22_1153.csv")
elsend1 <- read.csv("../../0_shared-data/latino-health-elsendero/raw/ElSenderoPathwaysToH_DATA_LABELS_2025-04-22_1154.csv")

# map the results




```

