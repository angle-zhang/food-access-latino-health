# Map basic input data

## Mapping food access poi

```{r}
tm_shape(la_county) +
  tm_borders() +
  tm_shape(foodinsp23_24_SSIclean) +
  tm_dots(col = "green", size = 0.01) +
  tm_layout(legend.position = c("left", "bottom"))

```

## Mapping population weighted census tract centroids

```{r}
tm_shape(la_county) +
  tm_borders() +
  tm_shape(la_ctcent_dat) +
  tm_dots(col = "red", size = 0.01) +
  tm_layout(legend.position = c("left", "bottom"))

tm_shape(la_county) +
  tm_borders() +
  tm_shape(la_hh_sample) +
  tm_dots(col = "black", size = 0.01) +
  tm_layout(legend.position = c("left", "bottom"))

```

# Inspecting point datasets

```{r}
# Select a random census tract
set.seed(123)
random_tract <- la_ct %>% slice_sample(n = 1)

# Find adjacent tracts
adjacent_tracts <- la_ct[st_touches(random_tract, la_ct, sparse = FALSE), ]

# Plot the selected and adjacent tracts
tmap_mode("view")

tm_shape(random_tract) + 
  tm_borders(lwd = 2, col = "red") + tm_fill(col = "pink", alpha = 0.5) +
  tm_shape(adjacent_tracts) + 
  tm_borders(lwd = 2, col = "blue") + tm_fill(col = "lightblue", alpha = 0.5) +
  tm_shape(la_ctcent_dat) +
  tm_dots(col = "red", size = 0.01) +
  tm_shape(la_ct_wtcent_dat) +
  tm_dots(col = "green", size = 0.01) +
  tm_shape(la_ct) + 
  tm_borders() +
  tm_layout(legend.position = c("left", "bottom"))

## TODO look into tracts with strange behavior ID = 980016, 990200 + 599100 (in the middle of ocean)

```

# Mapping POI and population-weighted centroids data

```{r}
tm_shape(la_county) +
  tm_borders() +
  tm_shape(foodinsp23_24_SSIclean) +
  tm_dots(col = "green", size = 0.01) +
  tm_shape(la_ct) +
  tm_borders() +
  tm_shape(la_ctcent_dat) +
  tm_dots(col = "red", size = 0.01) +
  tm_layout(legend.position = c("left", "bottom"))

```

## Map terrain elevation and street network features

```{r}

elev <- get_dem("socal", proj_crs)

ocean <- rnaturalearth::ne_download(scale = 10, type = "ocean", category = "physical", returnclass = "sf") %>%
  st_transform(proj_crs) %>%
  st_make_valid()


tmap_options(check.and.fix = TRUE)

tm_shape(elev) +
  tm_raster(palette = terrain.colors(100), style = "cont", title = "Elevation (m)") + tm_shape(ocean) +
  tm_fill(col = "lightblue", alpha = 0.9) +  # Add ocean layer bodies
  tm_shape(lac_boundary) + 
   tm_borders(col = "black", alpha=.5) +
   tm_shape(lac_buffer) + 
  tm_borders(col = "black", alpha=.5)# Add county boundary


```

## Visualizing OSM

```{r}
  osm_lines <- get_osm(bbox=lac_bbox)
  ht = c("raceway") # highway types to remove
  # highway types https://wiki.openstreetmap.org/wiki/Key:highway#Roads
  osm_paths = osm_lines[!(osm_lines$highway %in% ht), ]
  plot(osm_paths["highway"], key.pos = 1)
  
  rm(osm_lines, osm_paths)
  
  #not enough heap space to run this 
  #network <- street_network_to_sf(r5r_core)


```
